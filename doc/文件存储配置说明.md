# 文件存储配置说明

本项目支持多种文件存储方式，包括阿里云OSS和FastDFS。通过配置文件可以灵活切换存储方式。

## 支持的存储类型

### 1. 阿里云OSS (默认)
- 适用于云环境部署
- 支持分片上传
- 高可用性和可靠性

### 2. FastDFS
- 适用于私有化部署
- 支持分布式存储
- 高性能文件存储

## 配置说明

### 基础配置

在 `application.yml` 中添加以下配置：

```yaml
app:
  # 文件存储配置
  file-storage:
    type: oss  # 可选值: oss, fastdfs
    enable-slice-upload: true
    slice-size: 5242880  # 5MB
```

### OSS配置

```yaml
app:
  oss:
    access-key-id: your-access-key-id
    access-key-secret: your-access-key-secret
    bucket-name: your-bucket-name
    endpoint: your-endpoint
```

### FastDFS配置

```yaml
app:
  fastdfs:
    server-url: http://your-fastdfs-server:8080
    connect-timeout: 5000
    read-timeout: 10000
    max-connections: 50
    max-idle-connections: 10
```

## 切换存储方式

### 从OSS切换到FastDFS

1. 修改配置文件中的存储类型：
```yaml
app:
  file-storage:
    type: fastdfs
```

2. 配置FastDFS服务器地址：
```yaml
app:
  fastdfs:
    server-url: http://your-fastdfs-server:8080
```

3. 重启应用

### 从FastDFS切换到OSS

1. 修改配置文件中的存储类型：
```yaml
app:
  file-storage:
    type: oss
```

2. 配置OSS参数：
```yaml
app:
  oss:
    access-key-id: your-access-key-id
    access-key-secret: your-access-key-secret
    bucket-name: your-bucket-name
    endpoint: your-endpoint
```

3. 重启应用

## 环境配置示例

### 开发环境 (application-dev.yml)

```yaml
app:
  file-storage:
    type: oss
  oss:
    access-key-id: dev-access-key
    access-key-secret: dev-access-secret
    bucket-name: dev-bucket
    endpoint: dev-endpoint
```

### 生产环境 (application-prod.yml)

```yaml
app:
  file-storage:
    type: fastdfs
  fastdfs:
    server-url: http://prod-fastdfs-server:8080
```

## 功能特性

### 分片上传
- 支持大文件分片上传
- 可配置分片大小
- 支持断点续传

### 文件类型支持
- 图片文件 (jpg, png, gif等)
- 文档文件 (pdf, doc, xls等)
- 视频文件 (mp4, avi等)
- 音频文件 (mp3, wav等)

### 文件用途分类
- 头像 (avatar)
- 公开图片 (public)
- 私有文件 (private)
- 酒店宣传图 (hotelPic)
- 商品图片 (product)

## 注意事项

1. **数据迁移**: 切换存储方式时，需要手动迁移已存储的文件
2. **FastDFS部署**: 使用FastDFS前需要先部署FastDFS服务器
3. **权限配置**: 确保应用有足够的权限访问存储服务
4. **网络配置**: 确保应用能够访问存储服务器

## 故障排除

### 常见问题

1. **上传失败**
   - 检查存储服务配置是否正确
   - 检查网络连接是否正常
   - 检查权限配置是否正确

2. **文件访问失败**
   - 检查文件URL是否正确
   - 检查存储服务是否正常运行
   - 检查文件是否存在

3. **性能问题**
   - 调整分片大小配置
   - 检查网络带宽
   - 优化存储服务配置

## 扩展开发

如需添加新的存储方式，需要：

1. 实现 `IFileHelper` 接口
2. 在 `FileType` 枚举中添加新类型
3. 在 `FileStorageStrategy` 中添加选择逻辑
4. 添加相应的配置类

示例：
```java
@Service
public class NewStorageFileHelper implements IFileHelper {
    // 实现接口方法
}
``` 